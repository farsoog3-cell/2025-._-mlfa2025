<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI تطريز متقدم</title>
<style>
body {background:#000;color:#fff;font-family:Arial,sans-serif;text-align:center;}
section{max-width:800px;margin:30px auto;padding:20px;background:#111;border-radius:10px;}
input,button{padding:10px;margin:5px;border-radius:5px;border:none;}
button{background:#222;color:#fff;cursor:pointer;}
button:hover{background:#444;}
</style>
</head>
<body>
<section>
<h1>AI تطريز متقدم</h1>

<input type="file" id="imageInput" accept="image/*"><br>
<input type="file" id="samplePesInput" accept=".pes"><br>
<input type="text" id="fileName" placeholder="اسم الملف"><br>
<button id="downloadBtn">تنزيل ملف PES</button>

<div id="status"></div>
</section>

<script>
const SERVER_URL="https://2025mlfa-2-7e2x.onrender.com/convert_image_with_ai_advanced";
const imageInput=document.getElementById('imageInput');
const samplePesInput=document.getElementById('samplePesInput');
const fileNameInput=document.getElementById('fileName');
const downloadBtn=document.getElementById('downloadBtn');
const status=document.getElementById('status');

downloadBtn.addEventListener('click',()=>{
    const imageFile=imageInput.files[0];
    const pesFile=samplePesInput.files[0];
    if(!imageFile || !pesFile){alert("يرجى رفع الصورة وملف PES المثال"); return;}

    const formData=new FormData();
    formData.append("image",imageFile);
    formData.append("sample_pes",pesFile);

    const fileName=fileNameInput.value || "ai_stitch_advanced";
    status.textContent="جارٍ إنشاء ملف PES...";

    fetch(SERVER_URL,{method:"POST",body:formData})
    .then(res=>res.blob())
    .then(blob=>{
        const link=document.createElement('a');
        link.href=URL.createObjectURL(blob);
        link.download=fileName+".pes";
        link.click();
        status.textContent="تم إنشاء ملف PES بنجاح!";
    })
    .catch(err=>{
        console.error(err);
        status.textContent="حدث خطأ أثناء إنشاء ملف PES.";
    });
});
</script>
</body>
</html>
