<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>مُصمم قوالب التطريز المتقدم</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f3f4f6; display:flex; flex-direction:column; align-items:center; padding:20px; }
    h1 { font-size:32px; margin-bottom:20px; color:#1f2937; }
    .container { display:flex; gap:20px; }
    .tools { width:250px; background:white; padding:15px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1); display:flex; flex-direction:column; gap:10px; }
    .tools label { display:flex; flex-direction:column; font-weight:bold; }
    .tools input, .tools select { margin-top:5px; padding:5px; border-radius:6px; border:1px solid #ccc; }
    #canvasContainer { background:white; padding:10px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
    canvas { border-radius:12px; background-color:#fdf6e3; cursor:crosshair; }
    button { margin-top:10px; padding:10px; background-color:#2563eb; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold; }
    button:hover { background-color:#1d4ed8; }
  </style>
</head>
<body>

<h1>مُصمم قوالب التطريز المتقدم</h1>

<div class="container">
  <div class="tools">
    <label>رفع صورة:
      <input type="file" id="uploadImage" accept="image/*">
    </label>
    <label>لون الخيط:
      <input type="color" id="threadColor" value="#FF0000">
    </label>
    <label>سمك الخيط:
      <input type="number" id="threadSize" value="2" min="1" max="10">
    </label>
    <label>طول الغرزة:
      <input type="number" id="stitchLength" value="5" min="1" max="20">
    </label>
    <label>نوع القماش:
      <select id="fabricType">
        <option value="cotton">قطن</option>
        <option value="linen">كتان</option>
        <option value="silk">حرير</option>
      </select>
    </label>
    <button id="downloadBtn">تنزيل PNG</button>
  </div>

  <div id="canvasContainer">
    <canvas id="embroideryCanvas" width="600" height="600"></canvas>
  </div>
</div>

<script>
  const canvas = document.getElementById('embroideryCanvas');
  const ctx = canvas.getContext('2d');

  const threadColor = document.getElementById('threadColor');
  const threadSize = document.getElementById('threadSize');
  const stitchLength = document.getElementById('stitchLength');
  const fabricType = document.getElementById('fabricType');
  const downloadBtn = document.getElementById('downloadBtn');
  const uploadImage = document.getElementById('uploadImage');

  let drawing = false;
  let points = [];
  let bgImage = null;

  function setCanvasBackground() {
    ctx.fillStyle = fabricType.value === 'cotton' ? '#fdf6e3' : fabricType.value === 'linen' ? '#eee8d5' : '#fff5f5';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    if(bgImage) ctx.drawImage(bgImage,0,0,canvas.width,canvas.height);
  }

  setCanvasBackground();

  canvas.addEventListener('mousedown', e => {
    drawing = true;
    points.push({x: e.offsetX, y: e.offsetY});
  });

  canvas.addEventListener('mousemove', e => {
    if(!drawing) return;
    const last = points[points.length - 1];
    const x = e.offsetX;
    const y = e.offsetY;

    ctx.strokeStyle = threadColor.value;
    ctx.lineWidth = threadSize.value;
    ctx.beginPath();
    ctx.moveTo(last.x, last.y);
    ctx.lineTo(x, y);
    ctx.setLineDash([stitchLength.value, stitchLength.value]); // تأثير الغرز
    ctx.stroke();
    points.push({x, y});
  });

  canvas.addEventListener('mouseup', () => { drawing = false; points=[]; });
  canvas.addEventListener('mouseleave', () => { drawing = false; points=[]; });

  fabricType.addEventListener('change', setCanvasBackground);

  uploadImage.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if(!file) return;
    const img = new Image();
    img.onload = () => {
      bgImage = img;
      setCanvasBackground();
    }
    img.src = URL.createObjectURL(file);
  });

  downloadBtn.addEventListener('click', () => {
    const link = document.createElement('a');
    link.download = 'embroidery_template.png';
    link.href = canvas.toDataURL();
    link.click();
  });
</script>

</body>
</html>
