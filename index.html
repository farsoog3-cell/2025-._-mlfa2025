<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل الدخول - مخطط تطريز</title>
<style>
html, body { margin:0; padding:0; height:100%; width:100%; font-family:'Segoe UI',sans-serif; display:flex; justify-content:center; align-items:center; background:#f0f2f5; }
#login-container { background:white; padding:40px; border-radius:20px; box-shadow:0 4px 20px rgba(0,0,0,0.2); text-align:center; width:90%; max-width:400px; }
#login-container h1 { margin-bottom:20px; color:#4b6cb7; }
input[type="text"] { width:80%; padding:10px; margin:10px 0; border-radius:10px; border:1px solid #ccc; font-size:1em; }
button { width:50%; padding:10px; margin-top:10px; border-radius:12px; border:none; background:#4b6cb7; color:white; font-weight:600; cursor:pointer; transition:0.3s; }
button:hover { background:#182848; }
#error { color:red; font-size:0.9em; margin-top:10px; display:none; }
</style>
</head>
<body>

<div id="login-container">
    <h1>تسجيل الدخول</h1>
    <input type="text" id="keyInput" placeholder="أدخل مفتاح الدخول">
    <br>
    <button id="loginBtn">دخول</button>
    <div id="error">المفتاح غير صحيح</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

// إعداد Firebase
const firebaseConfig = {
  apiKey: "AIzaSyD0Hh1e5lq4yfKO9iIPStC6wFfUgXH-6ps",
  authDomain: "fsgsvsb-3af4e.firebaseapp.com",
  databaseURL: "https://fsgsvsb-3af4e-default-rtdb.firebaseio.com",
  projectId: "fsgsvsb-3af4e",
  storageBucket: "fsgsvsb-3af4e.firebasestorage.app",
  messagingSenderId: "740413309189",
  appId: "1:740413309189:web:86aa992833f1452d8d376c",
  measurementId: "G-TBP47X82ZE"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// التعامل مع تسجيل الدخول
const loginBtn = document.getElementById('loginBtn');
const keyInput = document.getElementById('keyInput');
const errorDiv = document.getElementById('error');

loginBtn.addEventListener('click', async () => {
    const key = keyInput.value.trim();
    if(!key){ 
        errorDiv.innerText = 'يرجى إدخال مفتاح'; 
        errorDiv.style.display = 'block'; 
        return; 
    }

    try {
        const dbRef = ref(db);
        const snapshot = await get(child(dbRef, `keys/${key}`)); // المفاتيح مخزنة تحت مفتاح keys
        if(snapshot.exists()){
            // المفتاح صحيح -> تحويل إلى صفحة الرسم
            window.location.href = "drawing.html"; // استبدل باسم صفحتك
        } else {
            errorDiv.innerText = 'المفتاح غير صحيح';
            errorDiv.style.display = 'block';
        }
    } catch (err) {
        console.error(err);
        errorDiv.innerText = 'خطأ في الاتصال بقاعدة البيانات';
        errorDiv.style.display = 'block';
    }
});
</script>

</body>
</html>
