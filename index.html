<!DOCTYPE html>
<html>
<head>
    <title>Embroidery Simulator</title>
    <style>
        body { font-family: Arial; text-align: center; background: #f0f0f0; }
        canvas { border: 1px solid #333; margin-top: 20px; }
        button { margin-top: 10px; padding: 10px 20px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>Embroidery Simulator</h1>
    <form id="uploadForm" enctype="multipart/form-data">
        <input type="file" name="image" required>
        <button type="submit">Upload & Simulate</button>
    </form>

    <canvas id="canvas" width="500" height="500"></canvas>
    <br>
    <a id="downloadLink" style="display:none;">Download DST</a>

    <script>
    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);

        // تغيير الرابط إلى السيرفر الخارجي
        const res = await fetch('https://2025mlfa-2-7e2x.onrender.com/upload', { method: 'POST', body: formData });
        const data = await res.json();

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // عرض الغرز
        data.stitches.forEach(stitch => {
            ctx.beginPath();
            ctx.moveTo(stitch[0][0], stitch[0][1]);
            ctx.lineTo(stitch[1][0], stitch[1][1]);
            ctx.strokeStyle = stitch.color;
            ctx.stroke();
        });

        const link = document.getElementById('downloadLink');
        link.href = 'https://2025mlfa-2-7e2x.onrender.com/download';
        link.style.display = 'inline';
        link.textContent = "Download DST File";
    });
    </script>
</body>
</html>
