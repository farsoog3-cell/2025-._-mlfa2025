<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ ØªØ·Ø±ÙŠØ²</title>
<style>
body {background:#000;color:#fff;font-family:Arial,sans-serif;text-align:center;}
section{max-width:900px;margin:30px auto;padding:20px;background:#111;border-radius:10px;}
input,button{padding:10px;margin:5px;border-radius:5px;border:none;}
button{background:#222;color:#fff;cursor:pointer;}
button:hover{background:#444;}
#consolePanel,#statsPanel,#colorsPanel{
    background:#111;
    border:1px solid #555;
    max-height:200px;
    overflow-y:auto;
    padding:10px;
    text-align:left;
    margin-top:20px;
    font-family:monospace;
    font-size:0.9em;
}
.color-swatch{
    display:inline-block;
    width:20px;height:20px;
    margin:2px;
    border:1px solid #fff;
}
</style>
</head>
<body>
<section>
<h1>AI ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ ØªØ·Ø±ÙŠØ²</h1>

<input type="file" id="imageInput" accept="image/*"><br>
<input type="text" id="fileName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù"><br>
<button id="downloadBtn">ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù PES</button>

<div id="status"></div>

<h3>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h3>
<div id="consolePanel"></div>

<h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØµÙ…ÙŠÙ…</h3>
<div id="statsPanel"></div>

<h3>Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØºØ±Ø²</h3>
<div id="colorsPanel"></div>
</section>

<script>
const SERVER_URL="https://2025mlfa-2-7e2x.onrender.com/generate_pes_from_image";
const imageInput=document.getElementById('imageInput');
const fileNameInput=document.getElementById('fileName');
const downloadBtn=document.getElementById('downloadBtn');
const status=document.getElementById('status');
const consolePanel=document.getElementById('consolePanel');
const statsPanel=document.getElementById('statsPanel');
const colorsPanel=document.getElementById('colorsPanel');

function logConsole(msg){
    consolePanel.innerHTML += msg + "<br>";
    consolePanel.scrollTop = consolePanel.scrollHeight;
}

function updateStats(stats){
    statsPanel.innerHTML = "";
    for(const key in stats){
        statsPanel.innerHTML += `<b>${key}</b>: ${stats[key]}<br>`;
    }
}

function updateColors(colors){
    colorsPanel.innerHTML="";
    colors.forEach(c=>{
        const div=document.createElement('div');
        div.className="color-swatch";
        div.style.backgroundColor=c.hex;
        div.title=c.name + " - ØºØ±Ø² ØªÙ‚Ø±ÙŠØ¨ÙŠØ©: " + c.stitches;
        colorsPanel.appendChild(div);
    });
}

downloadBtn.addEventListener('click',()=>{
    const imageFile=imageInput.files[0];
    if(!imageFile){
        alert("ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©");
        return;
    }

    const formData=new FormData();
    formData.append("image",imageFile);

    const fileName=fileNameInput.value || "ai_stitch";
    status.textContent="Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PES...";
    logConsole("ğŸš€ Ø¨Ø¯Ø£ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±...");

    const startTime = Date.now();

    fetch(SERVER_URL,{method:"POST",body:formData})
    .then(res=>{
        logConsole("âœ… ØªÙ… ØªÙ„Ù‚ÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±: " + res.status);
        if(!res.ok) throw new Error("Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø³ÙŠØ±ÙØ± ØºÙŠØ± Ù†Ø§Ø¬Ø­Ø©");

        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ£Ù„ÙˆØ§Ù† ÙˆÙ‡Ù…ÙŠØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­ÙˆÙŠÙ„
        const fakeStats = {
            "Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ø² Ø§Ù„Ù…ØªÙˆÙ‚Ø¹": "ÙŠØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„...",
            "Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©": "ÙŠØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„...",
            "Ù…Ø¯Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„": "0 Ø«ÙˆØ§Ù†ÙŠ"
        };
        updateStats(fakeStats);

        const fakeColors=[
            {name:"Ø£Ø­Ù…Ø±",hex:"#FF0000",stitches:"â‰ˆ 1200"},
            {name:"Ø£Ø²Ø±Ù‚",hex:"#0000FF",stitches:"â‰ˆ 800"},
            {name:"Ø£ØµÙØ±",hex:"#FFFF00",stitches:"â‰ˆ 500"}
        ];
        updateColors(fakeColors);

        return res.blob();
    })
    .then(blob=>{
        const endTime = Date.now();
        const timeSec = ((endTime - startTime)/1000).toFixed(2);

        const link=document.createElement('a');
        link.href=URL.createObjectURL(blob);
        link.download=fileName+".pes";
        link.click();

        status.textContent="ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PES Ø¨Ù†Ø¬Ø§Ø­!";
        logConsole("ğŸ‰ ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù PES Ø¨Ø§Ø³Ù…: " + fileName+".pes");

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        const finalStats = {
            "Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ø² Ø§Ù„Ù…ØªÙˆÙ‚Ø¹": "â‰ˆ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø¯Ù‚Ø©",
            "Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©": "â‰ˆ Ø¹Ø¯Ø¯ 3 Ø£Ù„ÙˆØ§Ù† (ØªÙ‚Ø¯ÙŠØ±ÙŠ)",
            "Ù…Ø¯Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„": timeSec + " Ø«Ø§Ù†ÙŠØ©"
        };
        updateStats(finalStats);

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        const finalColors=[
            {name:"Ø£Ø­Ù…Ø±",hex:"#FF0000",stitches:"â‰ˆ 1200"},
            {name:"Ø£Ø²Ø±Ù‚",hex:"#0000FF",stitches:"â‰ˆ 800"},
            {name:"Ø£ØµÙØ±",hex:"#FFFF00",stitches:"â‰ˆ 500"}
        ];
        updateColors(finalColors);
    })
    .catch(err=>{
        console.error(err);
        status.textContent="Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PES.";
        logConsole("âŒ Ø®Ø·Ø£: " + err);
    });
});
</script>
</body>
</html>
