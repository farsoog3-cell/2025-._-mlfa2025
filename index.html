<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>رفع صورة وتحويلها لقالب تطريز</title>
</head>
<body>
<h2>رفع صورة لتحويلها إلى DST/DSE</h2>
<input type="file" id="imageUpload" accept="image/*">
<select id="fileType">
    <option value="DST">DST</option>
    <option value="DSE">DSE</option>
</select>
<button id="uploadBtn">رفع وتحويل</button>

<script>
document.getElementById('uploadBtn').addEventListener('click', async ()=>{
    const fileInput = document.getElementById('imageUpload');
    if(fileInput.files.length===0){ alert("اختر ملف أولاً"); return; }
    const file = fileInput.files[0];
    const fileType = document.getElementById('fileType').value;

    const formData = new FormData();
    formData.append('file', file);
    formData.append('type', fileType);

    try{
        const response = await fetch('http://localhost:5000/upload',{
            method:'POST',
            body:formData
        });
        if(!response.ok){
            const text = await response.text();
            alert("خطأ: "+text);
            return;
        }
        const blob = await response.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download=`pattern.${fileType.toLowerCase()}`;
        a.click();
        alert("تم إنشاء الملف بنجاح!");
    }catch(err){
        alert("خطأ في الاتصال بالسيرفر: "+err);
    }
});
</script>
</body>
</html>
