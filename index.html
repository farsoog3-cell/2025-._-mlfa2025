<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>تحويل الصورة إلى تطريز</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f0f0; display: flex; flex-direction: column; align-items: center; padding: 50px;}
h1 { color: #333; }
input, button { margin: 10px; padding: 10px; font-size: 16px; }
#status { margin-top: 20px; font-weight: bold; color: green; }
</style>
</head>
<body>
<h1>تحويل الصورة إلى ملف تطريز DST</h1>
<input type="file" id="imageInput" accept="image/*">
<br>
<button onclick="startProcessing()">ابدأ المعالجة</button>
<button id="downloadBtn" style="display:none;">تنزيل الملف</button>
<div id="status"></div>

<script>
let dstFile = null;

function startProcessing(){
    const input = document.getElementById("imageInput");
    if(!input.files.length){ alert("يرجى اختيار صورة"); return; }

    const file = input.files[0];
    const formData = new FormData();
    formData.append("image", file);

    document.getElementById("status").innerText = "⚡ جاري المعالجة... يرجى الانتظار";

    fetch("http://127.0.0.1:5000/generate_dst_from_image", {
        method: "POST",
        body: formData
    })
    .then(response => {
        if(!response.ok) throw new Error("فشل في المعالجة");
        return response.blob();
    })
    .then(blob => {
        dstFile = URL.createObjectURL(blob);
        document.getElementById("status").innerText = "✅ تم الانتهاء! يمكنك تنزيل الملف";
        const btn = document.getElementById("downloadBtn");
        btn.style.display = "inline-block";
        btn.onclick = () => { window.location = dstFile; }
    })
    .catch(err => {
        document.getElementById("status").innerText = "❌ حدث خطأ: " + err.message;
    });
}
</script>
</body>
</html>
