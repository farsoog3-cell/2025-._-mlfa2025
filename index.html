<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Embroidery Generator</title>
<style>
    body {
        background-color: #111;
        color: #eee;
        font-family: "Arial", sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
    }
    h1 {
        margin-bottom: 20px;
        font-weight: 400;
    }
    input[type="file"] {
        margin: 20px 0;
    }
    button {
        background-color: #222;
        color: #eee;
        border: 2px solid #eee;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
        border-radius: 5px;
    }
    button:hover {
        background-color: #eee;
        color: #111;
        border-color: #111;
    }
    #colors-info {
        margin-top: 20px;
    }
    .color-box {
        display: inline-block;
        width: 20px;
        height: 20px;
        margin: 2px;
        border: 1px solid #eee;
    }
</style>
</head>
<body>
<h1>تحويل الصورة إلى تطريز باستخدام AI</h1>
<input type="file" id="imageInput" accept="image/*">
<button onclick="uploadImage()">رفع وتحويل</button>

<div id="colors-info"></div>

<script>
function uploadImage() {
    const fileInput = document.getElementById('imageInput');
    if (fileInput.files.length === 0) {
        alert("اختر صورة أولاً");
        return;
    }

    const formData = new FormData();
    formData.append("image", fileInput.files[0]);

    fetch("/generate_dst_from_image", {
        method: "POST",
        body: formData
    })
    .then(response => {
        if (!response.ok) throw new Error("خطأ في رفع الصورة");
        return response.blob().then(blob => {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = "ai_stitch.dst";
            link.click();

            const colorsHeader = response.headers.get('X-Colors-Info');
            if (colorsHeader) {
                const colors = JSON.parse(colorsHeader);
                const container = document.getElementById('colors-info');
                container.innerHTML = "ألوان التصميم:<br>";
                colors.forEach(c => {
                    const box = document.createElement('span');
                    box.className = 'color-box';
                    box.style.backgroundColor = c.hex;
                    container.appendChild(box);
                });
            }
        });
    })
    .catch(err => alert(err));
}
</script>
</body>
</html>
